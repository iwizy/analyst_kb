# JSON-RPC

JSON-RPC — это протокол удалённого вызова процедур (RPC), который использует формат данных JSON (JavaScript Object Notation) для передачи сообщений между клиентом и сервером. JSON-RPC является лёгким и независимым от языка программирования протоколом, предоставляющим стандартизированный способ для обмена данными и выполнения удалённых вызовов процедур.

В отличие от других RPC-протоколов, таких как XML-RPC, JSON-RPC работает исключительно с JSON, что делает его простым, гибким и эффективным для интеграции в различные системы и приложения.

## Структура JSON-RPC

Каждое сообщение в JSON-RPC, будь то запрос или ответ, представляет собой объект в формате JSON. Протокол использует следующие основные элементы:

- jsonrpc — версия протокола. На данный момент поддерживается версия "2.0".
- method — имя вызываемой процедуры или метода на сервере.
- params — (необязательный) список параметров, передаваемых в метод.
- id — (необязательный) уникальный идентификатор, позволяющий связать запрос и ответ.

## Структура запроса

Запрос JSON-RPC может выглядеть следующим образом:

```text
{ "jsonrpc": "2.0", "method": "add", "params": [1, 2], "id": 1 }
```

- jsonrpc: Указывает на версию протокола (в данном случае "2.0").
- method: Имя метода или процедуры, который нужно вызвать на сервере (в данном случае метод "add").
- params: Список аргументов, передаваемых в метод (например, [1, 2] для метода сложения).
- id: Уникальный идентификатор запроса, который помогает связать запрос с ответом. Этот идентификатор может быть любым строковым или числовым значением, например, 1.

## Структура ответа

Ответ на запрос состоит из следующих полей:

```text
{ "jsonrpc": "2.0", "result": 3, "id": 1 }
```

- jsonrpc: Версия протокола (в данном случае "2.0").
- result: Результат выполнения метода. Это может быть любое значение, которое метод возвращает (например, результат сложения).
- error: (необязательное) описание ошибки, если она произошла.
- id: Идентификатор запроса, которому соответствует данный ответ. Это важно для того, чтобы связать запрос с его результатом.
  Если произошла ошибка, то в ответе будет присутствовать поле error:

```text
{ "jsonrpc": "2.0", "error": { "code": -32602, "message": "Invalid params" }, "id": 1 }
```

- code: Код ошибки, определяющий тип ошибки (например, -32602 для ошибки с параметрами).
- message: Описание ошибки.
- id: Идентификатор запроса, к которому относится ошибка.

## Методы JSON-RPC

Протокол JSON-RPC поддерживает вызов различных методов на сервере. Например:

- add — складывает два числа.
- subtract — вычитает одно число из другого.
- multiply — умножает два числа.
- divide — делит одно число на другое.

### Пример запросов и ответов

Сложение:

Запрос:

```text
{ "jsonrpc": "2.0", "method": "add", "params": [5, 7], "id": 1 }
```

Ответ:

```text
{ "jsonrpc": "2.0", "result": 12, "id": 1 }
```

Вычитание:

Запрос:

```text
{ "jsonrpc": "2.0", "method": "subtract", "params": [9, 4], "id": 2 }
```

Ответ:

```text
{ "jsonrpc": "2.0", "result": 5, "id": 2 }
```

Умножение:

Запрос:

```text
{ "jsonrpc": "2.0", "method": "multiply", "params": [3, 7], "id": 3 }
```

Ответ:

```text
{ "jsonrpc": "2.0", "result": 21, "id": 3 }
```

Деление:

Запрос:

```text
{ "jsonrpc": "2.0", "method": "divide", "params": [10, 2], "id": 4 }
```

Ответ:

```text
{ "jsonrpc": "2.0", "result": 5, "id": 4 }
```

## Диаграмма запросов и ответов в формате mermaid

## Множественные запросы и ответы

JSON-RPC поддерживает возможность отправки нескольких запросов в одном пакете. Это называется "batch request" (пакетный запрос). Например:

Запрос:

```text
[ { "jsonrpc": "2.0", "method": "add", "params": [1, 2], "id": 1 }, { "jsonrpc": "2.0", "method": "subtract", "params": [5, 3], "id": 2 } ]
```

Ответ:

```text
[ { "jsonrpc": "2.0", "result": 3, "id": 1 }, { "jsonrpc": "2.0", "result": 2, "id": 2 } ]
```

Это позволяет значительно повысить эффективность коммуникации, отправляя несколько запросов и получая все ответы одновременно.

## Особенности JSON-RPC

- Простота реализации: JSON-RPC не требует сложных схем или заголовков для сообщений, что упрощает реализацию.
- Гибкость: Протокол не накладывает ограничений на то, какие данные могут быть переданы в запросах и ответах. Он позволяет передавать любые данные в формате JSON.
- Асинхронность: JSON-RPC поддерживает как синхронные, так и асинхронные вызовы. Клиент может не блокировать выполнение программы и продолжать работу, пока сервер обрабатывает запрос.
- Обработка ошибок: Протокол чётко описывает ошибки, которые могут возникнуть при обработке запроса. Ошибки имеют свои коды и сообщения.

## Преимущества и недостатки JSON-RPC

### Преимущества

- Широкая совместимость: JSON — это универсальный формат, который поддерживается почти всеми языками программирования.
- Гибкость и простота: Благодаря использованию JSON протокол JSON-RPC легко интегрируется с любыми системами и не требует значительных вычислительных ресурсов.
- Низкий уровень зависимости: JSON-RPC не зависит от специфической реализации серверов или клиентов, что делает его подходящим для разнообразных задач и приложений.

### Недостатки

- Отсутствие формальных типов: Поскольку JSON — это формат текстового представления, все данные передаются как строки или числа, что ограничивает использование сложных типов данных.
- Отсутствие встроенной поддержки безопасности: JSON-RPC не включает механизмы шифрования или аутентификации, поэтому для обеспечения безопасности нужно использовать дополнительные технологии (например, HTTPS).
  JSON-RPC является эффективным и простым решением для взаимодействия между клиентом и сервером, позволяя легко интегрировать различные системы и приложения.
