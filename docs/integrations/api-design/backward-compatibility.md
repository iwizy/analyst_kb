# Обратная совместимость

Обратная совместимость это способность API эволюционировать без поломки существующих клиентов.

## Цель

- сохранить работоспособность текущих интеграций;
- снизить стоимость миграций;
- обеспечить предсказуемый lifecycle версий.

## Правила non-breaking изменений

- добавление нового optional поля;
- добавление нового endpoint/operation;
- добавление нового значения enum при наличии fallback;
- добавление нового response header.

## Что считается breaking

- удаление поля/операции;
- изменение типа поля (`string -> number`);
- изменение семантики существующего кода ошибки;
- обязательность ранее optional поля.

## Матрица совместимости

| Изменение | Совместимо? | Комментарий |
| --- | --- | --- |
| Новое optional поле в JSON | Да | Старый клиент игнорирует |
| Переименование поля | Нет | Нужна новая версия |
| Новый error code | Условно | Клиент должен иметь generic обработчик |
| Изменение URL endpoint | Нет | Только через versioning |

## Процесс управления изменениями

1. Зафиксировать change proposal и impact.
1. Прогнать automated contract diff.
1. Объявить deprecation period.
1. Обновить docs/SDK/examples.
1. Мониторить adoption новой версии.

## Пример deprecation policy

- `v1` поддерживается 12 месяцев после выхода `v2`.
- За 90 дней до отключения публикуется sunset notice.
- После sunset endpoint возвращает `410 Gone`.

## Практические рекомендации

- делать tolerant-reader на клиентах;
- не менять семантику статусов молча;
- включать compatibility tests в CI;
- вести changelog с примерами миграции.

## Смежные материалы

- [Версионирование API](versioning.md)
- [Документирование API (OpenAPI, RAML)](api-documentation.md)
