# Деревья решений

Дерево решений - нотация для формализации логики выбора на основе условий. В системной аналитике используется для бизнес-правил, скоринга, маршрутизации, тарифов и eligibility-проверок.

## Цель и задачи

- сделать логику принятия решения прозрачной и проверяемой;
- исключить конфликтующие и дублирующиеся правила;
- автоматически получать тест-кейсы по ветвям.

## Основные элементы

| Элемент | Назначение |
| --- | --- |
| Корневой узел | целевой вопрос (`Одобрить?`, `Назначить тариф?`) |
| Узел-условие | проверка параметра |
| Ветвь | результат условия |
| Лист | финальное решение/действие |

## Когда применять

- много ветвлений `if/else` и пороговых значений;
- требуется формальная проверка полноты и непротиворечивости правил;
- нужно передать бизнес-логику в тестирование и реализацию.

## Пример

```kroki-plantuml
@startmindmap
* Заявка
** Доход >= 120000?
*** Да
**** Скоринг >= 700?
***** Да: Одобрить
***** Нет: Ручная проверка
*** Нет
**** Есть залог?
***** Да: Ручная проверка
***** Нет: Отказать
@endmindmap
```

Дополнительно дерево переводится в таблицу решений для тестов и реализации.

| Доход | Скоринг | Залог | Решение |
| --- | --- | --- | --- |
| >= 120000 | >= 700 | - | Одобрить |
| >= 120000 | < 700 | - | Ручная проверка |
| < 120000 | - | Да | Ручная проверка |
| < 120000 | - | Нет | Отказать |

## Пошаговый алгоритм построения

1. Опишите цель решения и входные параметры.
1. Отсортируйте условия по влиянию на исход.
1. Постройте ветви с взаимоисключающими условиями.
1. Проверьте полноту: каждый вход должен попадать в одну ветвь.
1. Преобразуйте дерево в decision table и тест-кейсы.

## Типовые ошибки

- пересекающиеся условия (`>=` и `>` с одинаковой границей);
- отсутствие ветви для `null/unknown` значений;
- слишком глубокое дерево без выделения независимых подправил.

## Визуальные рекомендации

- используйте единый формат условий (`Поле оператор значение`);
- выделяйте листья типом решения (`Approve`, `Reject`, `Manual Review`);
- для сложной логики разбивайте дерево на набор независимых деревьев.

## Связь с другими нотациями

- `UML Activity`: ветвления Activity можно формализовать через дерево.
- `BPMN`: gateway-условия рекомендуется подтверждать деревом решений.
- `State Machine`: правила переходов между статусами можно извлекать из дерева.

## Инструменты

- [Draw.io](../tools/drawio.md)
- [PlantUML](../tools/plantuml.md)
