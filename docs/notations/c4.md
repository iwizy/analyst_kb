# C4

C4 (Context, Container, Component, Code) - подход к архитектурному описанию,
который дает разные уровни детализации для разных аудиторий. Главная ценность
C4 в том, что он убирает перегрузку: сначала контекст, затем детали.

## Когда использовать

- нужно объяснить архитектуру бизнесу, разработке и эксплуатации на одном языке;
- важно быстро онбордить новых участников команды;
- требуется прозрачная связь между сервисами и ответственностью команд.

## Уровни C4

| Уровень | Для кого | Что показывает |
| --- | --- | --- |
| 1. Context | бизнес, продукт, аналитики | границы системы и внешние взаимодействия |
| 2. Container | архитекторы, тимлиды | крупные части системы: UI, API, БД, очереди |
| 3. Component | разработчики, аналитики | внутреннюю структуру контейнера |
| 4. Code | разработчики | классы/модули реализации |

## Пример: интернет-магазин

### Level 1 (Context)

```kroki-plantuml
@startuml
left to right direction
actor "Покупатель" as Customer
rectangle "Система\nинтернет-магазина" as Shop
rectangle "Платежный\nпровайдер" as Payment
rectangle "Служба\nдоставки" as Delivery

Customer --> Shop
Shop <--> Payment
Shop <--> Delivery
@enduml
```

### Level 2 (Container)

```kroki-plantuml
@startuml
left to right direction
node "Web App" as Web
node "API Gateway" as Gateway
node "Order Service" as Order
database "PostgreSQL" as Db
queue "Kafka" as Kafka
node "Notification Service" as Notify

Web --> Gateway
Gateway --> Order
Order --> Db
Order --> Kafka
Kafka --> Notify
@enduml
```

### Level 3 (Component для Order Service)

```kroki-plantuml
@startuml
left to right direction
component "OrderController" as C
component "OrderApplicationService" as A
component "OrderDomainService" as D
component "OrderRepository" as R
component "PricingPolicy" as P

C --> A
A --> D
A --> R
D --> P
@enduml
```

### Level 4 (Code)

На этом уровне обычно используют UML class diagram или кодовые артефакты,
а не отдельную схему для каждого класса во всей системе.

## Практика применения

1. Начинайте с контекста и фиксируйте внешние зависимости.
1. Для каждого контейнера назначайте владельца (team ownership).
1. Декомпозируйте компоненты только там, где есть сложная логика.
1. Обновляйте C4 при архитектурных изменениях вместе с ADR.

## Типичные ошибки

- попытка сразу рисовать Level 3/4 без общего контекста;
- смешение технических деталей и бизнес-терминов на одном уровне;
- отсутствие границ ответственности команд.

## Чек-лист качества

- У каждого уровня есть понятная аудитория.
- Схемы согласованы между собой по названиям и связям.
- По C4-модели можно восстановить ключевые интеграции и риски.
