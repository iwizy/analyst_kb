# C4

C4 (Context, Container, Component, Code) - подход к архитектурному моделированию, который показывает систему на нескольких уровнях детализации. Нотация помогает говорить об архитектуре понятно для разных ролей.

## Цель и задачи

- показать границы системы и внешние зависимости;
- декомпозировать решение от уровня продукта до внутренней структуры сервиса;
- связать архитектурные решения с зонами ответственности команд.

## Уровни C4

| Уровень | Для кого | Что показывает |
| --- | --- | --- |
| Context | бизнес, аналитики, продукт | система как "черный ящик" и внешние акторы |
| Container | архитекторы, техлиды | крупные части системы и способы взаимодействия |
| Component | разработчики, аналитики | внутреннюю структуру контейнера |
| Code | разработчики | классы/модули реализации |

## Когда применять

- проектирование новой системы или значимой переработки архитектуры;
- онбординг новых участников команды;
- impact-анализ при изменениях в интеграциях и инфраструктуре.

## Пример: Context + Container

```kroki-plantuml
@startuml
left to right direction
actor "Покупатель" as Customer
rectangle "Платформа заказов" as System
rectangle "Платежный провайдер" as Payment
rectangle "Сервис доставки" as Delivery
rectangle "CRM" as CRM

Customer --> System : оформляет заказ
System --> Payment : оплата
System --> Delivery : запрос доставки
System --> CRM : синхронизация клиента
@enduml
```

```kroki-plantuml
@startuml
left to right direction
node "Web UI" as UI
node "API Gateway" as GW
node "Order Service" as Order
node "Payment Service" as Pay
database "PostgreSQL" as DB
queue "Kafka" as Kafka

UI --> GW
GW --> Order
GW --> Pay
Order --> DB
Order --> Kafka
Kafka --> Pay
@enduml
```

## Пошаговый алгоритм построения

1. Опишите `Context`: внешние пользователи, системы, границы.
1. Определите контейнеры (`UI`, `API`, `DB`, `Queue`) и их ответственность.
1. Для проблемных контейнеров добавьте `Component` уровень.
1. Проверьте, что названия элементов отражают бизнес-функции, а не только технологии.
1. Укажите владельцев контейнеров и критичность зависимостей.

## Типовые ошибки

- старт сразу с уровня `Component` без согласованного контекста;
- смешение разных уровней C4 в одной диаграмме;
- отсутствие внешних систем, которые фактически критичны для сценария.

## Визуальные рекомендации

- храните отдельные диаграммы по уровням, не объединяйте их в одну;
- поддерживайте единые имена контейнеров во всех разделах документации;
- подписывайте связи действием (`читает`, `публикует`, `вызывает`).

## Связь с другими нотациями

- `UML Class` и `ERD`: уточняют внутреннюю структуру данных контейнеров.
- `UML Sequence`: показывает конкретные runtime-вызовы между контейнерами.
- `ArchiMate`: добавляет enterprise-контекст и мотивационный слой.

## Инструменты

- [PlantUML](../tools/plantuml.md)
- [Draw.io](../tools/drawio.md)
- Structurizr (для model-first подхода к C4)
