# [C4](../glossary.md#abbr-011)

C4 — модель архитектурного описания, которая показывает систему на четырех уровнях детализации: Context, Container, Component, Code.

## Уровни сложности

### Базовый уровень

- различать уровни C1 и C2;
- строить обзор системы для бизнеса и команды;
- показывать границы системы и внешние зависимости.

### Средний уровень

- декомпозировать контейнеры до C3-компонентов;
- связывать C4 с интеграциями, надежностью и [SLA](../glossary.md#abbr-079);
- поддерживать единый стиль легенды и naming.

### Продвинутый уровень

- использовать C4 как живую архитектурную документацию;
- автоматизировать генерацию диаграмм из Structurizr DSL;
- управлять архитектурными изменениями через [ADR](../glossary.md#abbr-003) + C4.

## Уровни C4

| Уровень | Что показывает | Аудитория |
| --- | --- | --- |
| C1 Context | система и внешние акторы/системы | бизнес, продукт, архитекторы |
| C2 Container | приложения/сервисы/БД и их взаимодействия | архитекторы, backend/devops |
| C3 Component | внутренние компоненты контейнера | разработчики, техлиды |
| C4 Code | кодовая структура (опционально) | разработчики |

## Пример: микросервисная e-commerce система (C1/C2)

```kroki-plantuml
@startuml
left to right direction
actor Customer
rectangle "E-commerce Platform" as SYS {
  rectangle "Web App" as WEB
  rectangle "Order Service" as ORD
  rectangle "Payment Service" as PAY
  database "PostgreSQL" as DB
  queue "Kafka" as K
}
rectangle "Bank API" as BANK

Customer --> WEB
WEB --> ORD : REST
ORD --> PAY : gRPC
ORD --> DB
PAY --> BANK : HTTPS
ORD --> K : OrderCreated event
@enduml
```

## Плюсы и минусы

| Плюсы | Минусы |
| --- | --- |
| высокая читаемость для разных аудиторий | не заменяет детальные [UML](../glossary.md#abbr-092)/[BPMN](../glossary.md#abbr-009) |
| понятная декомпозиция по уровням | требует дисциплины в актуализации |
| удобно связывать с [ADR](../glossary.md#abbr-003) и roadmap | [C4](../glossary.md#abbr-011) Code часто дублирует код/[IDE](../glossary.md#abbr-040) |

## Когда C4 лучше UML

- нужен архитектурный обзор для широкого круга участников;
- требуется показать boundaries и интеграции на одном экране;
- важно быстро объяснить устройство системы без технической перегрузки.

## Правила построения

1. На каждом уровне оставляйте только релевантные элементы.
2. Используйте единые обозначения, цвета и легенду.
3. Подписывайте технологию и ответственность контейнеров.
4. Не смешивайте C1/C2/C3 в одной диаграмме.
5. Ссылайтесь на связанные требования и [NFR](../glossary.md#abbr-053).

## Типичные ошибки и как избежать

| Ошибка | Как избежать |
| --- | --- |
| слишком много блоков на C1 | ограничьте контекст 5-7 ключевыми сущностями |
| нет технологической подписи контейнеров | добавляйте `Tech + Responsibility` |
| смешение процессов и архитектуры | процессы выносите в BPMN/Sequence |
| устаревшие диаграммы | versioning и регулярный архитектурный review |

## Инструменты и форматы

- Structurizr DSL, PlantUML C4, draw.io C4 templates;
- экспорт: SVG/PNG/PDF, DSL source в Git.
## Стандарты и источники

- C4 Model official site: <https://c4model.com/>
- Structurizr DSL: <https://docs.structurizr.com/dsl>
- TOGAF documentation fundamentals: <https://www.opengroup.org/togaf>
