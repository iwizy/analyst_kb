# DFD

DFD (Data Flow Diagram) показывает движение данных между внешними участниками, процессами и хранилищами. Нотация отвечает на вопрос: какие данные откуда приходят, как преобразуются и куда уходят.

## Цель и задачи

- зафиксировать потоки данных и границы системы;
- обнаружить пропуски в интеграциях и хранении данных;
- подготовить основу для API-контрактов и интерфейсных требований.

## Основные элементы

| Элемент | Назначение |
| --- | --- |
| External Entity | Внешний источник или потребитель данных |
| Process | Преобразование данных внутри системы |
| Data Store | Хранилище данных |
| Data Flow | Поток данных между элементами |

## Уровни детализации

- `Level 0 (Context)`: система как единый процесс.
- `Level 1`: декомпозиция на ключевые подпроцессы.
- `Level 2+`: детализация сложных подпроцессов.

## Пример: контекст и декомпозиция

```kroki-plantuml
@startuml
left to right direction
actor "Клиент" as Customer
rectangle "Система заказов" as Orders
rectangle "Платежный шлюз" as Payment
rectangle "Склад" as Warehouse

Customer --> Orders : Заказ
Orders --> Payment : Данные оплаты
Payment --> Orders : Статус платежа
Orders --> Warehouse : Запрос резерва
Warehouse --> Orders : Статус резерва
Orders --> Customer : Статус заказа
@enduml
```

```kroki-plantuml
@startuml
left to right direction
actor "Клиент" as Customer
database "D1 Заказы" as D1
database "D2 Остатки" as D2
rectangle "1. Принять заказ" as P1
rectangle "2. Проверить оплату" as P2
rectangle "3. Резервировать товар" as P3
rectangle "Платежный шлюз" as Payment

Customer --> P1 : Данные заказа
P1 --> D1 : Сохраненный заказ
D1 --> P2 : Заказ на оплату
P2 --> Payment : Платежные данные
Payment --> P2 : Результат оплаты
D1 --> P3 : Позиции заказа
P3 --> D2 : Запрос на резерв
D2 --> P3 : Результат резерва
P3 --> Customer : Ответ по заказу
@enduml
```

## Пошаговый алгоритм построения

1. Определите границы системы и список внешних участников.
1. Постройте контекстную диаграмму (`Level 0`).
1. Декомпозируйте систему на 3-7 процессов (`Level 1`).
1. Добавьте хранилища данных и направления потоков.
1. Проверьте балансировку: входы/выходы `Level 0` должны присутствовать на `Level 1`.

## Типовые ошибки

- процесс назван действием, но потоки данных названы действиями, а не сущностями;
- отсутствуют хранилища там, где данные фактически сохраняются;
- DFD используется как процессная диаграмма с таймингом.

## Визуальные рекомендации

- подписывайте потоки существительными (`Платежный статус`, `Заявка`, `Профиль клиента`);
- разделяйте логические и физические DFD, если нужна детализация инфраструктуры;
- на одном уровне избегайте более 10-12 процессов.

## Связь с другими нотациями

- `BPMN`: DFD дает данные для шагов процесса и сообщений.
- `ERD`: из потоков DFD выводятся сущности и атрибуты модели данных.
- `Sequence`: потоки превращаются в конкретные API-сообщения.

## Инструменты

- [Draw.io](../tools/drawio.md)
- [PlantUML](../tools/plantuml.md)
