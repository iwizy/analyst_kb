# DFD

> Глоссарий терминов и сокращений: [Открыть](../glossary.md)


DFD (Data Flow Diagram) показывает, как данные перемещаются между внешними сущностями, процессами и хранилищами.

## Уровни сложности

### Базовый уровень

- различать внешние сущности, процессы и хранилища;
- строить контекстную диаграмму;
- именовать потоки данных.

### Средний уровень

- декомпозировать модель на уровень 0 и ниже;
- поддерживать нумерацию процессов;
- валидировать баланс потоков между уровнями.

### Продвинутый уровень

- использовать DFD для impact analysis интеграций;
- связывать DFD с API/event/file контрактами;
- строить DFD как базу для threat modeling.

## Элементы DFD

| Элемент | Назначение |
| --- | --- |
| External Entity | внешний участник/система |
| Process | преобразование данных |
| Data Store | хранилище данных |
| Data Flow | поток данных между элементами |

## Уровни и нумерация

| Уровень | Содержание |
| --- | --- |
| Context | один процесс-система и внешние сущности |
| Level 0 | основные процессы внутри системы |
| Level 1+ | декомпозиция процессов Level 0 |

- Нумерация: `1.0`, `2.0`, затем `2.1`, `2.2` и т.д.
- Правило баланса: входы/выходы родительского процесса должны сохраняться на уровне декомпозиции.

## Пример: система учета заказов

```kroki-plantuml
@startuml
rectangle "Покупатель" as Customer
rectangle "1.0 Оформить заказ" as P1
rectangle "2.0 Обработать оплату" as P2
rectangle "3.0 Управлять отгрузкой" as P3
database "D1 Заказы" as D1
database "D2 Платежи" as D2
rectangle "Платежный шлюз" as PSP

Customer --> P1 : данные заказа
P1 --> D1 : запись заказа
P1 --> P2 : запрос оплаты
P2 --> PSP : платежный запрос
PSP --> P2 : статус платежа
P2 --> D2 : запись транзакции
P2 --> P3 : подтвержденный заказ
P3 --> Customer : статус отгрузки
@enduml
```

## Плюсы и минусы

| Плюсы | Минусы |
| --- | --- |
| наглядно показывает маршруты данных | не показывает временную последовательность подробно |
| полезен для интеграций и интерфейсов | легко переусложнить множеством мелких потоков |
| помогает найти лишние и отсутствующие потоки | не заменяет ERD для структуры данных |

## ERD vs DFD

| Вопрос | ERD | DFD |
| --- | --- | --- |
| как устроены данные | да | частично |
| как движутся данные | частично | да |
| где хранится сущность | да | да |
| кто и когда инициирует поток | ограниченно | да |

## Как строить

1. Начните с контекстной DFD (система как один процесс).
2. Разбейте на Level 0 с 3-7 основными процессами.
3. Добавьте хранилища и внешние системы.
4. Пронумеруйте процессы и подпишите потоки данных.
5. Проверьте баланс между уровнями.

## Типичные ошибки и как избежать

| Ошибка | Как избежать |
| --- | --- |
| потоки без названия | подписывайте каждый data flow |
| "черный ящик" без декомпозиции | раскрывайте ключевые процессы на Level 1 |
| нет баланса уровней | проверяйте parent-child consistency |
| смешение управляющих и data-flow стрелок | оставляйте только потоки данных |

## Инструменты и форматы

- draw.io, Lucidchart, Visio, PlantUML (схемный стиль);
- экспорт: SVG/PNG/PDF.
## Стандарты и источники

- Yourdon/DeMarco DFD approach (классика SADT/DFD)
- BABOK (process and data modeling): <https://www.iiba.org/standards-and-resources/babok/>
- Gane & Sarson notation references: <https://www.smartdraw.com/data-flow-diagram/>
