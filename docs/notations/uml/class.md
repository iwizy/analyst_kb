# [UML](../../glossary.md#abbr-092) Class Diagram

[Диаграмма](../../glossary.md#term-022) классов показывает структуру домена: сущности, их атрибуты, поведение и отношения.

## Уровни сложности

### Базовый уровень

- моделировать классы, атрибуты и простые ассоциации;
- отличать агрегацию, композицию и наследование;
- читать кратность связей.

### Средний уровень

- проектировать доменные и сервисные классы без перегрузки деталями;
- отражать инварианты и ограничения в модели;
- синхронизировать Class Diagram с [ERD](../../glossary.md#abbr-032)/[API](../../glossary.md#abbr-005)-контрактами.

### Продвинутый уровень

- применять UML для bounded contexts и anti-corruption layers;
- выявлять SRP/GRASP нарушения на этапе моделирования;
- использовать XMI/репозитории для управления большими моделями.

## Элементы и синтаксис

| Элемент | Назначение |
| --- | --- |
| Class | сущность с атрибутами и операциями |
| Association | связь между классами |
| Aggregation | слабая связь "часть-целое" |
| Composition | сильная связь "жизненный цикл зависит" |
| Generalization | наследование/обобщение |
| Multiplicity | кратность: `1`, `0..1`, `1..*` |

## Пример: интернет-магазин

```kroki-plantuml
@startuml
class Customer {
  +id: UUID
  +name: String
}

class Order {
  +id: UUID
  +status: OrderStatus
  +totalAmount: Money
  +confirm()
}

class OrderItem {
  +sku: String
  +qty: int
  +price: Money
}

class Payment {
  +id: UUID
  +status: PaymentStatus
  +authorize()
}

Customer "1" -- "0..*" Order : places
Order "1" *-- "1..*" OrderItem : contains
Order "1" o-- "0..1" Payment : linked
@enduml
```

## Плюсы и минусы

| Плюсы | Минусы |
| --- | --- |
| четко показывает структуру и границы ответственности | при перегрузке теряется читаемость |
| помогает синхронизировать терминологию команды | легко скатиться в "диаграмму всего" |
| полезна для ревью доменной модели | не показывает динамику выполнения |

## Когда выбирать

- описываете доменную модель и инварианты;
- нужно согласовать данные между аналитиком, разработкой и [QA](../../glossary.md#abbr-067);
- требуется трассировка от требований к структуре объектов.

## Как строить

1. Зафиксируйте bounded context и ключевые сущности.
2. Добавьте только значимые атрибуты и операции.
3. Проставьте связи и кратность.
4. Уточните композиции/агрегации по жизненному циклу.
5. Проверьте соответствие [ERD](../../glossary.md#abbr-032) и [API](../../glossary.md#abbr-005)-схемам.

## Типичные ошибки и как избежать

| Ошибка | Как избежать |
| --- | --- |
| слишком много технических деталей | держите фокус на доменной задаче |
| смешение уровней (домен + DB + [UI](../../glossary.md#abbr-091)) | делайте отдельные диаграммы по слоям |
| неверная кратность | валидируйте с бизнес-правилами и данными |
| нарушение SRP | разделяйте классы по единой ответственности |

## Инструменты и форматы

- PlantUML, draw.io, Enterprise Architect;
- экспорт: SVG/PNG для документации, XMI для репозиториев моделей.
## Стандарты и источники

- [UML](../../glossary.md#abbr-092) 2.5.1: <https://www.omg.org/spec/UML/2.5.1>
- Fowler, UML Distilled: <https://martinfowler.com/books/uml.html>
- GRASP patterns: <https://en.wikipedia.org/wiki/GRASP_(object-oriented_design)>
