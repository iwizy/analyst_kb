# UML Sequence

Диаграмма последовательности показывает, как участники обмениваются сообщениями во времени. Это основной инструмент для проектирования API-сценариев, интеграционных вызовов и обработки исключений.

## Цель и задачи

- формализовать шаги взаимодействия между пользователем, сервисами и внешними системами;
- определить контрактные точки (запросы, ответы, коды ошибок, таймауты);
- найти риски по надежности: повторные вызовы, потеря ответа, гонки.

## Основные элементы

| Элемент | Назначение |
| --- | --- |
| Actor/Participant | Участник сценария |
| Lifeline | Временная ось участника |
| Message | Вызов или событие |
| Return Message | Ответ на вызов |
| Activation | Период активной обработки |
| `alt` / `opt` / `loop` / `par` | Ветки, опции, циклы, параллелизм |

## Когда применять

- детализация вызовов в интеграции между сервисами;
- моделирование happy-path и негативных сценариев;
- подготовка тестовых сценариев по API-контракту.

## Пример

```kroki-plantuml
@startuml
actor Клиент
participant "Web App" as Web
participant "Auth API" as Auth
participant "Identity Provider" as IdP
participant "Profile API" as Profile

Клиент -> Web : Войти
Web -> Auth : POST /sessions
Auth -> IdP : validate(credentials)

alt Учетные данные валидны
  IdP --> Auth : token
  Auth -> Profile : GET /users/{id}
  Profile --> Auth : профиль
  Auth --> Web : 200 + access_token
  Web --> Клиент : Вход выполнен
else Неверный логин/пароль
  IdP --> Auth : invalid
  Auth --> Web : 401 Unauthorized
  Web --> Клиент : Ошибка входа
end
@enduml
```

## Как построить диаграмму

1. Зафиксируйте границы сценария: стартовый триггер и финальный результат.
1. Перечислите участников в порядке слева направо: инициатор, оркестратор, внешние сервисы.
1. Опишите основной поток вызовов.
1. Добавьте альтернативные ветки (`alt`) для ошибок и таймаутов.
1. Отметьте повторные шаги (`loop`) и параллельные действия (`par`) при необходимости.

## Типовые ошибки

- нет альтернативных веток для ошибок и отказов;
- сообщения названы абстрактно (`process`, `handle`) без конкретного действия;
- смешаны бизнес-события и транспортный шум в одном уровне детализации.

## Визуальные рекомендации

- размещайте участников стабильно: клиент -> gateway -> сервис -> внешняя система;
- называйте сообщения как операции контракта (`POST /orders`, `Publish PaymentReceived`);
- ограничивайте одну диаграмму одним сценарием, не больше 15-20 сообщений.

## Связь с другими нотациями

- `BPMN`: шаг процесса можно детализировать через `Sequence`.
- `DFD`: поток данных из DFD превращается в сообщения `Sequence`.
- `State Machine`: события из `Sequence` часто являются триггерами смены состояния.

## Инструменты

- [PlantUML](../../tools/plantuml.md)
- [Draw.io](../../tools/drawio.md)
