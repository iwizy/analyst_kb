# UML Sequence Diagram

Диаграмма последовательности показывает порядок взаимодействия участников во времени и помогает анализировать интеграционные сценарии.

## Уровни сложности

### Базовый уровень

- показывать участников и последовательность сообщений;
- различать синхронные и асинхронные вызовы;
- отмечать возвраты и ошибки.

### Средний уровень

- использовать `alt`, `opt`, `loop` для бизнес-ветвлений;
- моделировать таймауты и fallback-сценарии;
- связывать сообщения с API-контрактами.

### Продвинутый уровень

- моделировать сквозные сценарии через несколько доменов;
- учитывать idempotency/retry/circuit breaker паттерны;
- использовать диаграмму для incident/postmortem анализа.

## Элементы и синтаксис

| Элемент | Назначение |
| --- | --- |
| Participant | участник взаимодействия |
| Message `->` | синхронный вызов |
| Message `->>` | асинхронный вызов |
| Return `-->` | возврат результата |
| `alt/else` | альтернативные ветви |
| `loop` | повторяющийся шаг |

## Пример: оформление заказа

```kroki-plantuml
@startuml
actor User
participant "Checkout API" as API
participant "Payment Service" as PAY
participant "Inventory Service" as INV

User -> API: POST /orders
API -> PAY: authorizePayment()
alt payment approved
  PAY --> API: ok
  API -> INV: reserveItems()
  alt stock available
    INV --> API: reserved
    API --> User: 201 Created
  else no stock
    INV --> API: failed
    API -> PAY: refund()
    API --> User: 409 OutOfStock
  end
else payment rejected
  PAY --> API: declined
  API --> User: 402 PaymentRequired
end
@enduml
```

## Плюсы и минусы

| Плюсы | Минусы |
| --- | --- |
| показывает причинно-следственную цепочку | длинные сценарии быстро перегружаются |
| выявляет точки отказа и таймауты | не показывает полную структуру данных |
| полезна для API и интеграционных ревью | требует дисциплины по уровню детализации |

## Когда выбирать

- нужно описать конкретный сценарий запроса/команды;
- анализируется поведение при ошибках и компенсациях;
- требуется согласовать контракты между сервисами.

## Как строить

1. Выберите один сценарий (happy path + 1-2 критичных исключения).
2. Зафиксируйте участников и их ответственность.
3. Расположите сообщения в строгом временном порядке.
4. Добавьте `alt/loop/opt` только для значимых ветвлений.
5. Проверьте соответствие API/очередям и ошибкам.

## Типичные ошибки и как избежать

| Ошибка | Как избежать |
| --- | --- |
| диаграмма на 200 шагов | делите по use-case и уровню абстракции |
| нет ошибок/таймаутов | всегда добавляйте failure branches |
| смешение бизнес- и low-level логов | держите единый уровень детализации |
| неявные названия сообщений | используйте глагол + объект действия |

## Инструменты и форматы

- PlantUML, Enterprise Architect, draw.io;
- экспорт: SVG/PNG для документации, PDF для ревью.
## Стандарты и источники

- UML 2.5.1: <https://www.omg.org/spec/UML/2.5.1>
- PlantUML sequence docs: <https://plantuml.com/sequence-diagram>
- Enterprise Integration Patterns: <https://www.enterpriseintegrationpatterns.com/>
