# Диаграмма состояний

Диаграмма состояний (State Machine Diagram) описывает жизненный цикл объекта:
в каких состояниях он бывает, какие события запускают переходы и какие действия
выполняются при входе/выходе из состояния.

## Когда использовать

- объект проходит несколько этапов (заказ, заявка, инцидент, документ);
- важны правила переходов и запреты на недопустимые действия;
- нужно устранить противоречия в бизнес-логике статусов.

## Ключевые элементы

- Initial State и Final State.
- State: состояние объекта.
- Transition: переход по событию/условию.
- Guard condition: ограничение перехода.
- Entry/Exit actions: действия при входе/выходе.

## Пример: жизненный цикл заказа

| Состояние | Событие | Следующее состояние |
| --- | --- | --- |
| `Draft` | Клиент подтвердил заказ | `PendingPayment` |
| `PendingPayment` | Оплата успешна | `Paid` |
| `PendingPayment` | Таймаут оплаты | `Cancelled` |
| `Paid` | Товар отгружен | `Shipped` |
| `Shipped` | Доставка подтверждена | `Completed` |
| `Paid` | Оформлен возврат | `Refunded` |

Текстовый вид переходов:

```kroki-plantuml
@startuml
[*] --> Draft
Draft --> PendingPayment : submitOrder
PendingPayment --> Paid : paymentSuccess
PendingPayment --> Cancelled : paymentTimeout
Paid --> Shipped : ship
Shipped --> Completed : deliveryConfirmed
Paid --> Refunded : refundApproved
Completed --> [*]
Cancelled --> [*]
Refunded --> [*]
@enduml
```

## Типичные ошибки

- статусы есть, а события переходов не определены;
- разрешены переходы, которые нарушают бизнес-правила;
- нет терминальных состояний для завершенных сценариев.

## Чек-лист качества

- Для каждого состояния определены допустимые события.
- Любой переход имеет бизнес-обоснование.
- Статусная модель синхронизирована с API и UI.
