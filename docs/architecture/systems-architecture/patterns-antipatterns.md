# Архитектурные паттерны, принципы и антипаттерны

Паттерны и принципы помогают принимать повторяемые архитектурные решения, снижать связность и ускорять эволюцию системы.

## Уровни сложности

### Базовый уровень

- понимать SOLID/KISS/DRY/YAGNI;
- различать паттерн и антипаттерн;
- применять простые правила проектирования в ежедневной работе.

### Средний уровень

- выбирать паттерны под конкретные NFR;
- обосновывать применение и стоимость поддержки;
- связывать паттерны с архитектурным стилем.

### Продвинутый уровень

- формировать каталог паттернов команды;
- измерять архитектурный эффект (lead time, error rate, cost);
- выстраивать governance против антипаттернов.

## SOLID, KISS, DRY, YAGNI

| Принцип | Суть | Типичное нарушение | Исправление |
| --- | --- | --- | --- |
| SRP | один модуль — одна ответственность | сервис с бизнес-логикой + SQL + HTTP | разделить на use-case, repo, adapter |
| OCP | расширение без изменения ядра | if/else по типам провайдера | Strategy/Factory + интерфейс |
| LSP | наследник подставляем вместо базового | наследник меняет контракт исключений | пересмотреть иерархию/контракт |
| ISP | узкие интерфейсы по задачам | один «толстый» interface на всё | разделить interface по ролям |
| DIP | зависимость от абстракций | домен зависит от ORM/SDK | ports/adapters, инъекция зависимостей |
| KISS | простое решение сначала | преждевременная сложная абстракция | убрать лишние слои |
| DRY | не дублировать знание | одинаковая валидация в 5 местах | выделить общую политику |
| YAGNI | не делать "на вырост" | микросервисы/ES до необходимости | минимальный стиль + план эволюции |

## Ключевые архитектурные паттерны

| Паттерн | Что решает | Где раскрыто |
| --- | --- | --- |
| Hexagonal | изоляция домена от инфраструктуры | [Hexagonal Architecture](hexagonal-architecture.md) |
| CQRS | разделение read/write моделей | [Event Sourcing и CQRS](event-sourcing-cqrs.md) |
| Event Sourcing | полная история изменений | [Event Sourcing и CQRS](event-sourcing-cqrs.md) |
| Clean/Onion | направленные зависимости внутрь домена | [Hexagonal Architecture](hexagonal-architecture.md) |
| DDD | архитектура вокруг предметной области | [DDD](../design-approaches/oop-design/ddd.md) |
| Saga | согласованность распределенных транзакций | [Интеграции](../../integrations/integration-methods/patterns.md) |
| API Gateway / Mesh | управление north-south и east-west трафиком | [API Gateway и Service Mesh](api-gateway-service-mesh.md) |

## Частые антипаттерны

| Антипаттерн | Симптом | Последствие |
| --- | --- | --- |
| Distributed Monolith | много sync-зависимостей | низкая автономность релизов |
| Shared Database | сервисы пишут в общие таблицы | сильная связность, миграционные риски |
| God Service | один сервис владеет всем | bottleneck команды и релизов |
| Chatty Integration | десятки вызовов на один сценарий | latency spikes, нестабильность |
| Golden Hammer | один стиль на все задачи | переусложнение или недоиспользование |

## Как выбирать паттерн

1. Зафиксируйте проблему и NFR-драйвер.
2. Выберите 1-2 паттерна-кандидата.
3. Оцените стоимость внедрения и операций.
4. Зафиксируйте решение в ADR.
5. Проверьте метриками после внедрения.

## Контрольные вопросы

1. Какие принципы нарушаются в текущем дизайне чаще всего?
2. Какой паттерн решает текущую проблему, а какой только добавляет сложность?
3. Как измерить, что паттерн принес пользу?
4. Какие антипаттерны уже видны в кодовой базе?

## Чек-лист самопроверки

- архитектурный паттерн связан с конкретным NFR;
- стоимость поддержки оценена заранее;
- антипаттерны отслеживаются в ревью;
- решения зафиксированы в ADR;
- есть post-implementation метрики.

## Стандарты и источники

- Martin Fowler patterns catalog: <https://martinfowler.com/>
- Evans, *Domain-Driven Design*.
- Vernon, *Implementing DDD*.
- Bass, Clements, *Software Architecture in Practice*.
