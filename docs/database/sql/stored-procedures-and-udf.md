# Хранимые процедуры и пользовательские функции

Хранимые процедуры и пользовательские функции (UDF, User-Defined Functions) в SQL используются для автоматизации и упрощения выполнения часто повторяющихся операций. Они позволяют упаковывать SQL-код в блоки, которые могут быть многократно использованы, что упрощает управление логикой на уровне базы данных.

## Хранимые процедуры\*

### Что это такое?

Хранимая процедура — это заранее скомпилированный и сохранённый на сервере блок SQL-кода, который можно вызвать по имени. Процедуры могут принимать параметры, выполнять различные операции с базой данных (включая модификацию данных) и возвращать выходные значения.

### Основные характеристики

- Входные (IN) — принимают значения.
- Выходные (OUT) — возвращают значения.
- Входо-выходные (INOUT) — одновременно принимают и возвращают значения.
- Поддержка сложной логики: Хранимые процедуры могут включать конструкции управления потоком, циклы, обработку ошибок.
- Могут выполнять любые действия с базой данных, такие как INSERT, UPDATE, DELETE или сложные выборки.
- Использование: Для автоматизации задач, таких как расчёты, массовая обработка данных, интеграция с внешними системами.

### Пример создания хранимой процедуры

```text
DELIMITER // CREATE PROCEDURE UpdateSalary( IN emp_id INT, IN salary_increase DECIMAL(10,2) ) BEGIN UPDATE employees SET salary = salary + salary_increase WHERE id = emp_id; END // DELIMITER ;
```

Вызов процедуры:

```text
CALL UpdateSalary(1, 500.00);
```

## Пользовательские функции (UDF)

### Что это такое?

Пользовательская функция — это блок SQL-кода, который возвращает одно значение (скалярная функция) или таблицу (табличная функция). Функции обычно используются для выполнения вычислений или преобразований данных.

### Основные характеристики

- Обязательное возвращаемое значение: Каждая функция должна возвращать значение с помощью оператора RETURN.
- Функции не могут изменять данные в базе (никаких INSERT, UPDATE, DELETE).
- Только чтение данных.
- Использование: Для выполнения вычислений, форматирования данных, создания агрегатов.

### Пример создания скалярной функции

```text
DELIMITER // CREATE FUNCTION GetFullName( first_name VARCHAR(50), last_name VARCHAR(50) ) RETURNS VARCHAR(101) BEGIN RETURN CONCAT(first_name, ' ', last_name); END // DELIMITER ;
```

Вызов функции:

```text
SELECT GetFullName('Иван', 'Иванов');
```

Результат:

```text
Иван Иванов
```

### Основные отличия между процедурами и функциями

### Когда использовать

- Хранимые процедуры подходят для сложных бизнес-логик, которые включают изменения данных, автоматизацию задач и взаимодействие с внешними системами.
- Функции подходят для выполнения вычислений, проверки условий или форматирования данных в запросах.
  Использование процедур и функций помогает структурировать код, повысить его повторяемость и производительность.
