# [SQL](../../glossary.md#abbr-084)

SQL-раздел оформлен как практический мини-курс: от базовых выборок до оптимизации запросов, блокировок и эксплуатационных практик.

## Уровни сложности

### Базовый

- `SELECT`, `WHERE`, `JOIN`, `GROUP BY`, сортировки;
- базовые индексы и работа с транзакциями.

### Средний

- подзапросы, оконные функции, планы выполнения;
- оптимизация IO и выбор индексной стратегии.

### Продвинутый

- управление блокировками и deadlocks;
- [[CI](../../glossary.md#abbr-016)/CD](../../glossary.md#abbr-017) для SQL-артефактов, процедур и [UDF](../../glossary.md#abbr-090);
- materialized views и оптимизация аналитических запросов.

## Что важно уметь системному аналитику

- формулировать проверяемые SQL-критерии для требований и отчетов;
- читать `EXPLAIN` и видеть bottleneck (seq scan, hash spill, nested loop on large set);
- понимать влияние изоляции транзакций на бизнес-процессы.

## Оптимизация запросов: базовая памятка

1. Сначала понять профиль запроса ([OLTP](../../glossary.md#abbr-060) vs [OLAP](../../glossary.md#abbr-059)).
2. Проверить план выполнения через `EXPLAIN (ANALYZE, BUFFERS)`.
3. Убрать лишние столбцы и ранжировать фильтрацию до join.
4. Проверить индексы по `WHERE`, `JOIN`, `ORDER BY`.
5. Для тяжелых отчетов рассмотреть materialized views.

## Блокировки и дедлоки

Типовые причины:

- разный порядок обновления таблиц в транзакциях;
- долгие транзакции с интерактивной логикой;
- `SELECT ... FOR UPDATE` без ограничения набора строк.

Базовые меры:

- единый порядок обновления сущностей;
- короткие транзакции;
- retry policy на уровне приложения для deadlock victims.

## Упражнения раздела

1. Написать запрос топ-10 клиентов по выручке за квартал.
2. Сравнить план запроса до и после добавления индекса.
3. Найти и исправить запрос с лишним full scan.
4. Спроектировать materialized view для ежесуточного отчета.

## Переход к подразделам

- [Селекты](selects.md)
- [Агрегатные функции](aggregate-functions.md)
- [Группировка и сортировка](grouping-sorting.md)
- [Вложенные запросы](subqueries.md)
- [Индексы](indexes.md)
- [Хранимые процедуры и пользовательские функции](stored-procedures-and-udf.md)
- [Оконные функции](window-functions.md)
## Стандарты и источники

- [ISO](../../glossary.md#abbr-043)/IEC 9075 SQL: <https://www.iso.org/standard/76583.html>
- PostgreSQL EXPLAIN: <https://www.postgresql.org/docs/current/using-explain.html>
- MySQL Optimizer: <https://dev.mysql.com/doc/refman/en/optimization.html>
