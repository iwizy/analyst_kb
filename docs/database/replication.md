# Реплицирование данных

Репликация это копирование изменений между узлами БД для отказоустойчивости, масштабирования чтения и геораспределения.

## Зачем нужна репликация

- повысить доступность при сбое primary;
- масштабировать read-нагрузку;
- размещать данные ближе к пользователям;
- ускорять backup и отчетные нагрузки на вторичных узлах.

## Типы репликации

### Синхронная

Запись подтверждается после фиксации на primary и реплике.

Плюс: строгая консистентность.

Минус: выше задержка записи.

### Асинхронная

Primary подтверждает запись сразу, реплики догоняют позже.

Плюс: высокая производительность.

Минус: возможен replication lag и временная рассинхронизация.

### Полусинхронная

Компромисс: подтверждение после фиксации на части реплик.

## Топологии

- primary-replica;
- multi-primary (реже, сложнее по конфликтам);
- cascading replication.

## Пример сценария

Интернет-магазин:

- primary обрабатывает покупки и оплаты;
- read-replica обслуживают каталог и историю заказов;
- аналитика читает данные из отдельной replica/CDC-пайплайна.

## Метрики, которые нужно мониторить

- replication lag (seconds);
- apply rate и backlog WAL/binlog;
- failover time;
- read-after-write consistency для клиентских сценариев.

## Типичные ошибки

- использовать replica для критичного read-after-write без sticky logic;
- не тестировать failover в регулярном режиме;
- не контролировать lag под пиковыми нагрузками;
- считать репликацию заменой полноценного backup.

## Практические рекомендации

- для критичных транзакций применять sync/quorum-подход;
- для read-heavy сценариев использовать async + контроль lag;
- разделять transactional и analytical контуры;
- документировать runbook переключения ролей.

## Смежные материалы

- [Консистентность и распределение](consistency-and-distribution.md)
- [Масштабирование БД](scaling/index.md)
- [Бэкапирование данных](backup.md)
