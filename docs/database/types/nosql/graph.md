# Графовые базы данных

Графовые БД моделируют сущности и связи как первичный объект хранения. Это эффективно для задач, где ценность в traversing, а не в табличных join.

## Уровни сложности

### Базовый

- узлы, ребра, свойства;
- базовые pattern-запросы.

### Средний

- моделирование графа под доменные сценарии;
- индексация lookup-узлов и ограничений.

### Продвинутый

- graph algorithms и hybrid архитектуры;
- контроль supernodes и оптимизация deep traversal.

## Когда применять

- anti-fraud/AML сети переводов;
- рекомендательные системы;
- knowledge graph;
- impact analysis зависимостей систем.

## Пример модели

```text
(Customer)-[:PLACED]->(Order)-[:CONTAINS]->(Product)
(Account)-[:TRANSFER_TO]->(Account)
```

## Пример запроса (Cypher)

```cypher
MATCH (a:Account {id: "A-100"})-[:TRANSFER_TO*1..4]->(b:Account)
RETURN b.id, count(*) AS paths
ORDER BY paths DESC
LIMIT 20;
```

## Целостность и консистентность

- локальные транзакции чаще ACID;
- в распределенных графах появляются компромиссы по latency/consistency;
- уникальность и целостность связей задавайте constraints.

## Индексация и производительность

- индексируйте стабильные идентификаторы (`id`, `external_key`);
- контролируйте supernodes (узлы со слишком высокой степенью);
- ограничивайте глубину traversal в online API.

## Безопасность

- RBAC по графовым сущностям;
- аудит чтения чувствительных связей;
- шифрование in-transit/at-rest.

## Миграция из реляционной модели

1. Выделить сценарии, где join depth критичен.
2. Смэппить таблицы в node/edge структуру.
3. Запустить dual-read сравнение ответов и SLA.
4. Оставить OLTP ядро в реляционной БД, граф использовать как специализированный слой.

## Типовые ошибки

- перенос всего домена в граф без обоснования;
- отсутствие ограничений уникальности;
- неконтролируемые supernodes;
- попытка делать BI wide-scan в графовом движке.

## Практические рекомендации

1. Начинайте с узкого бизнес-кейса (fraud/reco).
2. Держите источник истины отдельно от graph read-model.
3. Каталогизируйте graph queries и их SLA.
4. Проверяйте плотность графа и распределение степеней.
## Стандарты и источники

- Neo4j docs: <https://neo4j.com/docs/>
- openCypher: <https://opencypher.org/>
- JanusGraph docs: <https://docs.janusgraph.org/>
