# Базы данных

Раздел собран как практическое руководство по выбору, проектированию и сопровождению БД: от модели хранения и консистентности до индексов, масштабирования и управления данными уровня предприятия.

## Что покрывает раздел

- выбор типа БД под профиль нагрузки и бизнес-ограничения;
- модели консистентности и распределения (ACID, BASE, CAP, eventual consistency);
- проектирование схем: ER-моделирование, нормализация/денормализация, star/snowflake;
- индексация и оптимизация запросов;
- масштабирование: партицирование, шардирование, репликация;
- платформенные темы: DWH, Data Lake, MDM, Data Governance.

## Карта раздела

```kroki-plantuml
@startuml
left to right direction
rectangle "Выбор типа БД" as T
rectangle "Консистентность\nACID / BASE / CAP" as C
rectangle "Проектирование схемы" as M
rectangle "Индексы и\nоптимизация запросов" as Q
rectangle "Масштабирование\nи отказоустойчивость" as S
rectangle "Data Platform\nDWH / Data Lake / MDM / Governance" as D

T --> C
C --> M
M --> Q
Q --> S
S --> D
@enduml
```

## Типы БД и когда их выбирать

| Тип | Когда подходит | Примеры систем | Сильные стороны | Ограничения |
| --- | --- | --- | --- | --- |
| Реляционные | Транзакционные процессы, строгая целостность | PostgreSQL, MySQL, Oracle, SQL Server | ACID, SQL, зрелые инструменты | Сложнее горизонтально масштабировать |
| Документные | Гибкая схема, быстро меняющиеся модели | MongoDB, Couchbase | Быстрая эволюция структуры | Риски при сложных join-сценариях |
| Key-value | Кэш, сессии, высокоскоростной доступ по ключу | Redis, DynamoDB | Очень высокая производительность | Ограниченные запросы по атрибутам |
| Колоночные NoSQL | Аналитика и агрегации больших объемов | Cassandra, HBase | Высокая пропускная способность записи/чтения | Сложность моделей и операций |
| Временных рядов | Метрики, телеметрия, IoT | InfluxDB, TimescaleDB | Эффективность time-window аналитики | Узкая специализация |
| Графовые | Сложные связи и маршруты | Neo4j, JanusGraph | Естественное представление связей | Не всегда оптимально для OLTP |
| Поисковые | Полнотекстовый поиск и релевантность | Elasticsearch, OpenSearch | Поиск и аналитика текста | Не замена транзакционной БД |
| NewSQL | OLTP + горизонтальный масштаб | CockroachDB, YugabyteDB, Google Spanner | SQL + распределенность + консистентность | Выше порог внедрения |
| Распределенные реестры | Неизменяемый журнал и доверенные транзакции | Hyperledger, Ethereum (enterprise usage) | Прозрачность и аудитируемость | Высокая сложность, ограничения throughput |

## ACID, BASE и CAP на практике

| Модель | Что гарантирует | Компромисс |
| --- | --- | --- |
| ACID | Строгая корректность транзакций | Потенциально ниже доступность при сбоях распределенной сети |
| BASE | Высокая доступность и масштаб | Возможна временная неконсистентность |
| CAP | В распределенной системе выбирается баланс между Consistency и Availability при Partition | Нужно явно проектировать trade-off под домен |

Практическое правило:

- финтех-платежи и критичные операции -> приоритет консистентности;
- рекомендации, фиды, кеши -> допустима eventual consistency.

## Быстрый алгоритм выбора БД

1. Определить критичность консистентности и допустимую задержку.
1. Разделить нагрузку на OLTP/OLAP/поиск/стрим.
1. Оценить изменчивость схемы данных.
1. Зафиксировать требования к масштабированию и доступности.
1. Выбрать 1 primary store + при необходимости специализированные хранилища.
1. Спроектировать схему, индексы, стратегию резервирования и мониторинга.

## Проектирование и эксплуатация: минимальный стандарт

- ER-модель связана с бизнес-сущностями и процессами;
- нормализация/денормализация обоснована типом запросов;
- индексы строятся по реальным query patterns;
- есть стратегия партицирования/шардирования/репликации;
- описаны backup/restore, RTO/RPO, мониторинг производительности;
- учтены MDM и Data Governance правила.

## Кейсы по доменам

### Финансовый сектор

- primary store: реляционная БД (ACID);
- дополнительно: поисковый индекс для расследований и аудит-отчетности;
- акцент: транзакционная корректность, безопасность, аудитируемость.

### E-commerce

- primary store: реляционная БД для заказов и платежей;
- дополнительно: key-value для корзины/кэша, search для каталога;
- акцент: баланс консистентности и скорости пользовательских сценариев.

### Госуслуги

- primary store: реляционная БД + строгий governance;
- дополнительно: DWH для отчетности, интеграционные витрины;
- акцент: регуляторика, трассируемость изменений, долговременное хранение.

## Первоисточники и стандарты

- ISO/IEC 9075 SQL: <https://www.iso.org/standard/76583.html>
- PostgreSQL docs: <https://www.postgresql.org/docs/>
- MySQL docs: <https://dev.mysql.com/doc/>
- MongoDB docs: <https://www.mongodb.com/docs/>
- Redis docs: <https://redis.io/docs/>
- Google Spanner docs: <https://cloud.google.com/spanner/docs>
- DAMA-DMBOK (data management): <https://www.dama.org/content/body-knowledge>

## Переход к подразделам

- [Типы баз данных](types/index.md)
- [Консистентность и распределение](consistency-and-distribution.md)
- [Распределенные реестры](distributed-ledgers/index.md)
- [Проектирование модели данных](data-modeling.md)
- [Нормализация и денормализация](normalization/index.md)
- [SQL](sql/index.md)
- [Масштабирование БД](scaling/index.md)
- [Реплицирование данных](replication.md)
- [DWH и Data Lake](dwh-and-data-lake.md)
- [Master Data Management (MDM)](mdm.md)
- [Data Governance](data-governance.md)
- [Бэкапирование данных](backup.md)

## Контрольные вопросы

- Почему для выбранного домена нужен именно этот компромисс ACID/BASE?
- Какие запросы определяют стратегию индексации?
- Какие данные должны храниться в primary store, а какие в специализированном хранилище?
- Как будет обеспечиваться восстановление после сбоя (RTO/RPO)?
- Какие правила Data Governance обязательны для вашего контура?
