# Декомпозиция требований

Декомпозиция переводит стратегическую цель в управляемые, оценимые и проверяемые элементы реализации. Ключевой принцип: сохранить бизнес-смысл на каждом уровне детализации.

## Цель

- разложить крупные цели на проверяемые части;
- снизить неопределенность перед оценкой и планированием;
- обеспечить трассировку от бизнес-результата к задачам и тестам.

## Модель «от зачем к что и как»

```text
Why (зачем): бизнес-цель и метрика
  -> What (что): бизнес- и пользовательские требования
    -> How (как): системные требования, API, правила, тесты
```

Практическое правило: если элемент нельзя связать с `Why`, его ценность не доказана.

## Основные техники декомпозиции

### Функциональная декомпозиция

Разбиение по функциональным блокам системы.

Когда подходит: крупные процессные системы с понятными подсистемами.

### Сценарная декомпозиция

Разбиение по ролям и пользовательским сценариям.

Когда подходит: продуктовые команды и UX-ориентированные инициативы.

### Декомпозиция по событиям

Разбиение по событиям жизненного цикла сущности.

Когда подходит: интеграционные контуры, event-driven архитектура.

### Декомпозиция по рискам

Сначала выделяются самые неопределенные/дорогие участки.

Когда подходит: инновационные или высокорискованные проекты.

## Расширенные техники

### Impact Mapping

Связка цели, акторов, поведенческих изменений и deliverables.

Шаблон:

- Goal -> Actors -> Impacts -> Deliverables.

Плюс: не дает уйти в «фичи ради фич».

### Story Splitting Patterns

Частые варианты деления:

- по бизнес-правилам;
- по операциям (create/read/update/delete);
- по типам данных;
- по happy path и edge-cases;
- по интерфейсам/каналам (web/mobile/API).

### Product Slicing

Формирование вертикальных срезов, которые дают ценность end-to-end.

Пример: «создание возврата + расчет суммы + уведомление» как один рабочий срез, а не отдельные «таблицы/формы/API».

### Event Storming

Выявление доменных событий, команд, агрегатов и политик.

Когда полезно: много интеграций, сложная бизнес-логика, размытые границы ответственности.

## Как выбрать технику декомпозиции

| Контекст | Приоритетная техника | Почему |
| --- | --- | --- |
| Нужен быстрый срез ценности для релиза | Product Slicing + Story Splitting | Дает вертикальные инкременты, готовые к реализации |
| Сложная мотивация стейкхолдеров | Impact Mapping | Сохраняет связь фич с бизнес-результатом |
| Много событий и интеграций | Event Storming | Выявляет реальные точки взаимодействия и риски |
| Высокая неопределенность | Риск-ориентированная декомпозиция | Сначала снижает самые дорогие риски |
| Стабильный процессный контур | Функциональная декомпозиция | Упрощает структурирование крупных систем |

## How-Why Ladder (шаблон)

```text
WHY: какую бизнес-цель достигаем?
  WHY+: почему это важно сейчас?
    WHAT: какое изменение в поведении пользователя нужно?
      HOW: какими системными возможностями это обеспечим?
        HOW+: как проверим, что это работает?
```

Практика: если на любом шаге нет внятного ответа, ветку нужно пересобрать до реализации.

## Пример декомпозиции (e-commerce)

Исходная цель:

- «Сократить время обработки возврата на 30%».

Декомпозиция:

- `BR-RET-01`: автоматизировать расчет суммы возврата.
- `UR-RET-05`: оператор выбирает позиции и видит сумму до подтверждения.
- `FR-RET-012`: система рассчитывает сумму с учетом скидок/комиссий.
- `NFR-RET-004`: p95 расчета <= 1 сек при 100 RPS.
- `AC-RET-031`: тестовые сценарии полного/частичного/ошибочного возврата.

Связь с roadmap:

- R1: полный возврат + ручная проверка;
- R2: частичный возврат + автопроверка правил;
- R3: прогноз задержек и proactive уведомления.

## Примеры по доменам

### Финансы

Цель: «Снизить долю неуспешных платежей на 20%».

Декомпозиция:

- BR: ввести повторные попытки с адаптивной стратегией;
- UR: оператор видит причины отказа и рекомендуемые действия;
- SR: retry policy, идемпотентность, журнал ошибок;
- NFR: задержка обработки не более 300 мс p95.

### Госуслуги

Цель: «Сократить срок обработки заявления на 25%».

Декомпозиция:

- BR: автоматизировать межведомственные проверки;
- UR: заявитель видит полный статус по этапам;
- SR: интеграции с реестрами, правила валидации данных;
- NFR: SLA межсистемного обмена до 10 минут.

## Критерии остановки декомпозиции

Останавливаем детализацию, когда:

- элемент можно оценить по effort и рискам;
- элемент можно реализовать в итерацию/инкремент;
- сформулированы проверяемые acceptance criteria;
- понятны зависимости и владельцы;
- нет скрытых «мульти-смыслов» внутри требования.

## Шаблон дерева декомпозиции

| Уровень | Пример содержимого |
| --- | --- |
| Why | Снизить TAT возврата на 30% |
| What (BR) | Автоматизировать расчет компенсации |
| What (UR) | Оператор подтверждает возврат в одном окне |
| How (SR) | FR/NFR/API/данные/правила ошибок |
| Verify | AC, тест-кейсы, метрики в эксплуатации |

## Визуальный шаблон декомпозиции

```kroki-plantuml
@startuml
left to right direction
rectangle "WHY\nБизнес-цель" as WHY
rectangle "WHAT\nBR/UR" as WHAT
rectangle "HOW\nSR/FR/NFR" as HOW
rectangle "VERIFY\nAC/Tests" as VER

WHY --> WHAT
WHAT --> HOW
HOW --> VER
@enduml
```

## Decision Tree (шаблон)

```kroki-plantuml
@startuml
start
:Требование готово к оценке?;
if (Да) then (Да)
  :Есть измеримые AC?;
  if (Да) then (Да)
    :Есть связи с BR/UR/SR и тестами?;
    if (Да) then (Да)
      :Передать в реализацию;
      stop
    else (Нет)
      :Доработать трассировку;
      stop
    endif
  else (Нет)
    :Уточнить критерии приемки;
    stop
  endif
else (Нет)
  :Продолжить декомпозицию;
  stop
endif
@enduml
```

## Инструменты

| Инструмент | Как использовать |
| --- | --- |
| Miro / FigJam | Карты декомпозиции, how-why ladder, совместные сессии |
| Jira / Azure DevOps | Разложение требований по иерархии Epic -> Feature -> Story |
| Confluence | Фиксация решений и контекста декомпозиции |
| EventStorming board | Разбор событий и границ ответственности |

## Типичные ошибки

- переход сразу к задачам разработки без UR-уровня;
- смешение «что нужно» и «как именно кодировать»;
- декомпозиция без NFR;
- потеря связи с roadmap и релизными срезами.

## Практические рекомендации

- проводить декомпозию на сессии BA + PO + Tech Lead + QA;
- фиксировать owner и риск для каждой ветки;
- делать сначала верхнеуровневую схему, затем детализацию по релизам;
- проверять готовность элементов через Definition of Ready.

## Мини-чек-лист перед передачей в разработку

- есть связь с бизнес-целью и KPI;
- сформулированы AC и тестовые сценарии;
- определены зависимости и ограничения;
- понятен релизный срез и приоритет;
- подтверждена реализуемость командой.

## Смежные материалы

- [Уровни требований](levels/index.md)
- [Структурирование требований](structuring.md)
- [Приоритизация требований](management/prioritization.md)
- [Трассировка требований](management/traceability.md)
