# Подходы к спецификации требований

Подход к спецификации определяет, в каком формате команда фиксирует требования, как их согласует и как проверяет на приемке. Неверный подход приводит либо к бюрократии, либо к потере критичных деталей.

## Как выбрать подход

1. Оценить контекст: домен, регуляторика, число команд, критичность интеграций.
1. Определить уровень формализации: легкий, средний, строгий.
1. Выбрать базовый формат (User Story, Use Case, JTBD, BRD/SRS) и дополнительные артефакты.
1. Зафиксировать обязательные поля и правила версионирования.
1. Встроить проверку качества в регулярный процесс review.

## Уровни формализации

### Легкая спецификация

Подходит для:

- discovery и ранних продуктовых фаз;
- быстрых итераций;
- низкой регуляторной нагрузки.

Обычно включает:

- user stories;
- acceptance criteria;
- простые диаграммы потоков.

Риск: пропуск зависимостей и нефункциональных требований.

### Средняя формализация

Подходит для:

- нескольких команд разработки;
- активных интеграций;
- высокой цены регресса.

Обычно включает:

- user stories/use cases;
- API-контракты;
- набор NFR;
- трассировку для критичных функций.

### Строгая формализация

Подходит для:

- regulated domains;
- контрактной разработки;
- внешнего аудита/приемки.

Обычно включает:

- BRD/SRS по согласованным шаблонам;
- baseline и change control;
- полную трассировку до тестов.

## Сравнение форматов: Use Case, User Story, JTBD

| Критерий | Use Case | User Story | JTBD |
| --- | --- | --- | --- |
| Фокус | сценарий и альтернативные потоки | пользовательская ценность итерации | мотивация и «работа, которую нужно сделать» |
| Когда лучше использовать | сложные процессы и интеграции | Agile delivery | discovery и проверка гипотез |
| Плюс | полнота и управляемость | скорость и компактность | глубокое понимание причин |
| Ограничение | может быть объемным | риск поверхностности | не хватает инженерной детализации |

## Пример одного требования в разных форматах

### Use Case

```text
UC-12: Частичный возврат заказа
Actor: Оператор
Preconditions: Заказ в статусе "Доставлен"
Main Flow:
1. Оператор открывает заказ
2. Выбирает позиции для возврата
3. Система рассчитывает сумму
4. Оператор подтверждает возврат
Alternate Flow:
A1. Позиция не подлежит возврату -> показать причину отказа
Postconditions: Создан документ возврата, клиент уведомлен
```

### User Story

```text
Как оператор,
я хочу оформить частичный возврат по выбранным позициям,
чтобы закрыть претензию без полного аннулирования заказа.

Acceptance Criteria:
- можно выбрать одну или несколько позиций;
- сумма рассчитывается автоматически;
- сохраняется причина возврата;
- клиент получает уведомление.
```

### JTBD

```text
Когда клиент возвращает часть заказа,
мне нужно быстро и корректно рассчитать компенсацию,
чтобы закрыть обращение в рамках SLA и избежать эскалации.
```

## Примеры фрагментов документов

### Фрагмент BRD

| Раздел | Содержание |
| --- | --- |
| Business Objective | Снизить среднее время обработки возврата на 30% за 2 квартала |
| KPI | TAT возврата, уровень повторных обращений, NPS по претензиям |
| In Scope | Частичный/полный возврат, уведомления клиенту, журнал причин |
| Out of Scope | Изменение antifraud-правил внешнего провайдера |
| Constraints | SLA партнера по биллингу: ответ до 5 минут |

### Фрагмент SRS

| Идентификатор | Формулировка |
| --- | --- |
| FR-RET-012 | Система рассчитывает сумму частичного возврата с учетом скидок и комиссий |
| NFR-RET-004 | p95 расчета суммы <= 1 сек при нагрузке 100 RPS |
| INT-RET-009 | API `/billing/refund-calc` возвращает результат в формате JSON v2 |

### User Story Mapping (шаблон)

| Backbone (активности) | Step | Story | Release Slice |
| --- | --- | --- | --- |
| Обработка возврата | Поиск заказа | Как оператор, хочу найти заказ по номеру | R1 |
| Обработка возврата | Выбор позиций | Как оператор, хочу отметить возвращаемые позиции | R1 |
| Обработка возврата | Расчет суммы | Как оператор, хочу видеть итог до подтверждения | R2 |
| Обработка возврата | Уведомление | Как клиент, хочу получить статус по email | R2 |

## Современные гибридные подходы

### Specification by Example

Суть: ключевые требования описываются через конкретные примеры входов/выходов, которые затем превращаются в тесты.

Когда полезно:

- сложные бизнес-правила;
- высокий риск разночтений между BA, Dev и QA.

### BDD (Behavior-Driven Development)

Суть: поведение формулируется в формате Given/When/Then и становится общим языком команды.

Мини-пример:

```gherkin
Given заказ доставлен
When оператор подтверждает частичный возврат
Then система создает документ возврата и отправляет уведомление клиенту
```

### Contract-First для API

Суть: сначала проектируется контракт (OpenAPI/Proto), затем реализация.

Плюсы:

- ранняя синхронизация интеграционных команд;
- возможность автоматической генерации заглушек и тестов;
- контроль обратной совместимости через diff контрактов.

## Шаблоны документов

### BRD (Business Requirements Document)

Минимальная структура:

- цели и бизнес-результат;
- KPI и критерии успеха;
- scope / out-of-scope;
- ограничения и допущения;
- карта стейкхолдеров;
- риски и зависимости.

### SRS (Software Requirements Specification)

Минимальная структура:

- контекст и границы системы;
- функциональные требования;
- нефункциональные требования;
- внешние интерфейсы и контракты;
- критерии верификации/валидации;
- глоссарий и трассировка.

### Backlog Item Card

Минимальная структура:

- ID и заголовок;
- описание (story/use case);
- acceptance criteria;
- приоритет и ценность;
- зависимости;
- ссылки на дизайн/API/тесты.

### Change Request

Минимальная структура:

- инициатор и причина изменения;
- описание изменения;
- impact analysis (scope/сроки/стоимость/риск);
- решение и согласующие;
- целевой релиз;
- затронутые требования и тесты.

## Версионирование и управление конфигурацией

### Правила версий

- Major: существенное изменение структуры/контракта;
- Minor: добавление или уточнение требований без ломки структуры;
- Patch: редакторские правки без изменения смысла.

Пример: `SRS-RET v2.3.1`.

### Что хранить в change log

- номер версии и дата;
- автор изменения;
- список измененных разделов;
- причина изменения;
- ссылка на CR/decision log.

### Практика конфигурационного управления

- единый источник правды (single source of truth);
- контроль прав на изменение baseline;
- обязательная связь версии спецификации с релизом.

## Инструменты и форматы живой документации

| Формат/инструмент | Когда использовать | Сильные стороны | Ограничения |
| --- | --- | --- | --- |
| Markdown | Технические команды, Git-flow | Простые diff, review, version control | Требует дисциплины по шаблонам |
| AsciiDoc | Крупные структурированные документы | Богатая разметка, генерация | Ниже порог входа у части участников |
| ReqIF | Формальный обмен требованиями между системами | Стандартизованный обмен | Сложнее в ежедневной работе |
| Confluence | Кросс-функциональная коллаборация | Быстрые шаблоны, комментарии | Нужен контроль версий и структуры |

## Работа со стандартами

### BABOK

Использовать как методическую карту задач аналитика, техник и артефактов.

### IEEE 830

Использовать как reference по структуре SRS и требованиям к качеству формулировок.

### ISO/IEC/IEEE 29148

Использовать как основной современный стандарт инженерии требований и жизненного цикла спецификаций.

Практическое правило: адаптировать стандарты под контекст проекта, а не копировать «как есть».

## Проверка качества спецификации

Чек-лист перед согласованием:

- у каждого требования есть источник и владелец;
- формулировка однозначна и тестируема;
- указаны ограничения и негативные сценарии;
- понятны приоритет и бизнес-обоснование;
- есть связь с тестами и релизным планом;
- change log и версия обновлены.

## Типичные ошибки

- смешение целей, требований и технической реализации;
- использование одного формата для всех задач без учета контекста;
- отсутствие правил версии и change log;
- «мертвая документация», не связанная с backlog и тестами.

## Практические рекомендации

- выбрать базовый формат на каждый уровень требований;
- дополнить его точечно: Use Case для сложных потоков, BDD для поведения, Contract-First для API;
- фиксировать минимальные обязательные поля для любого требования;
- проводить ревизию актуальности спецификации в cadence команды.

## Смежные материалы

- [Критерии качества требований](quality.md)
- [Валидация и верификация требований](validation.md)
- [Структурирование требований](structuring.md)
- [Управление изменениями требований](management/change-management.md)
- [BABOK](../common-competencies/standards/babok.md)
- [IEEE](../common-competencies/standards/ieee.md)
